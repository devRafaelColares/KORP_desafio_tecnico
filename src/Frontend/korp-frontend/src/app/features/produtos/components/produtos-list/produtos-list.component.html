<div class="page-container">
    <!-- Header -->
    <app-page-header title="Produtos" subtitle="Gerencie o catálogo de produtos do sistema" icon="package">
        <button korp-button variant="primary" (click)="openModal()">
            <i class="icon-plus"></i>
            Novo Produto
        </button>
    </app-page-header>

    <!-- Main Content -->
    <div class="content-wrapper">
        <!-- Alert -->
        <app-alert *ngIf="alert()" [type]="alert()!.type" [message]="alert()!.message" (close)="closeAlert()">
        </app-alert>

        <!-- Loading -->
        <app-loading *ngIf="isLoading()"></app-loading>

        <!-- Content -->
        <div *ngIf="!isLoading()">
            <!-- Search Bar -->
            <app-card class="search-card">
                <div class="search-wrapper">
                    <i class="icon-search"></i>
                    <input type="text" placeholder="Buscar por descrição ou código SKU..." [value]="searchTerm()"
                        (input)="onSearchChange($any($event.target).value)" class="search-input">
                </div>
            </app-card>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <app-card>
                    <h3 class="stat-label">Total de Produtos</h3>
                    <p class="stat-value">{{ totalProdutos }}</p>
                </app-card>

                <app-card>
                    <h3 class="stat-label">Produtos em Estoque</h3>
                    <p class="stat-value stat-success">{{ produtosEmEstoque }}</p>
                </app-card>

                <app-card>
                    <h3 class="stat-label">Sem Estoque</h3>
                    <p class="stat-value stat-danger">{{ produtosSemEstoque }}</p>
                </app-card>
            </div>

            <!-- Table -->
            <app-card>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Código SKU</th>
                                <th>Descrição</th>
                                <th class="text-right">Preço</th>
                                <th class="text-center">Saldo</th>
                                <th class="text-center">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Empty State -->
                            <tr *ngIf="filteredProdutos().length === 0">
                                <td colspan="5" class="empty-state">
                                    <i class="icon-package"></i>
                                    <p class="empty-title">Nenhum produto encontrado</p>
                                    <p class="empty-subtitle">
                                        {{ searchTerm()
                                        ? 'Tente buscar com outros termos'
                                        : 'Cadastre seu primeiro produto' }}
                                    </p>
                                </td>
                            </tr>

                            <!-- Data Rows -->
                            <tr *ngFor="let produto of filteredProdutos()" class="data-row">
                                <td>
                                    <span class="sku-badge">{{ produto.codigoSKU }}</span>
                                </td>
                                <td>{{ produto.descricao }}</td>
                                <td class="text-right">
                                    <strong>{{ produto.preco | currency: 'BRL' }}</strong>
                                </td>
                                <td class="text-center">
                                    <span class="badge" [ngClass]="getSaldoClass(produto.saldo)">
                                        {{ produto.saldo }} un
                                    </span>
                                </td>
                                <td class="text-center">
                                    <div class="action-buttons">
                                        <button class="btn-icon btn-edit" (click)="openModal(produto)" title="Editar">
                                            <i class="icon-edit"></i>
                                        </button>
                                        <button class="btn-icon btn-delete" (click)="deleteProduto(produto)"
                                            title="Excluir">
                                            <i class="icon-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </app-card>
        </div>
    </div>
</div>

<!-- Modal -->
<app-modal [isOpen]="isModalOpen()" [title]="editingProduto ? 'Editar Produto' : 'Novo Produto'" (close)="closeModal()">

    <div class="form-container">
        <!-- SKU -->
        <app-input label="Código SKU *" [(ngModel)]="formData.codigoSKU" [error]="formErrors['codigoSKU']"
            [disabled]="!!editingProduto" placeholder="Ex: PROD-001">
        </app-input>

        <!-- Descrição -->
        <app-input label="Descrição *" [(ngModel)]="formData.descricao" [error]="formErrors['descricao']"
            placeholder="Ex: Notebook Dell Inspiron">
        </app-input>

        <!-- Preço -->
        <app-input label="Preço (R$) *" type="number" step="0.01" [(ngModel)]="formData.preco"
            [error]="formErrors['preco']" placeholder="Ex: 3500.00">
        </app-input>

        <!-- Saldo -->
        <app-input label="Saldo Inicial *" type="number" [(ngModel)]="formData.saldo" [error]="formErrors['saldo']"
            placeholder="Ex: 15">
        </app-input>

        <!-- Actions -->
        <div class="modal-actions">
            <button korp-button variant="primary" [disabled]="isSaving()" (click)="saveProduto()">
                {{ isSaving() ? 'Salvando...' : (editingProduto ? 'Atualizar' : 'Cadastrar') }}
            </button>
            <button korp-button variant="secondary" [disabled]="isSaving()" (click)="closeModal()">
                Cancelar
            </button>
        </div>
    </div>
</app-modal>